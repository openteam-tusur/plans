class Department < ActiveRecord::Base
  attr_accessible :abbr, :title, :number, :subdepartments_attributes

  belongs_to :year

  has_many :subdepartments, :dependent => :destroy

  validates_presence_of :title, :abbr, :year

  scope :actual, where(:deleted_at => nil)

  def chief(year_number)
    departments = YAML.load_file("data/#{year_number}/departments.yml")
    department_hash = departments.select { |dep_hash| dep_hash['abbr'] == abbr }
    return Person::NIL unless department_hash
    department_hash = department_hash[0]
    return Person::NIL unless department_hash
    return Person::NIL unless department_hash['chief']
    Person.new(department_hash['chief'])
  end
end
#--
# generated by 'annotated-rails' gem, please do not remove this line and content below, instead use `bundle exec annotate-rails -d` command
#++
# Table name: departments
#
# * id         :integer         not null
#   title      :string(255)
#   abbr       :string(255)
#   number     :integer
#   year_id    :integer
#   deleted_at :datetime
#   created_at :datetime        not null
#   updated_at :datetime        not null
#
#  Indexes:
#   index_departments_on_year_id  year_id
#--
# generated by 'annotated-rails' gem, please do not remove this line and content above, instead use `bundle exec annotate-rails -d` command
#++
